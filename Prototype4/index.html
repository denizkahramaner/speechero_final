<html>
	<head>
		<meta charset="utf-8">

		<link href="css/bootstrap.css" 					type="text/css" rel="stylesheet">
		<link href="css/bootstrap-responsive.min.css" 	type="text/css" rel="stylesheet">
		<link href="css/typica.css" 					type="text/css" rel="stylesheet">
		<link href="css/impress-demo.css" 				type="text/css" rel="stylesheet">
		<link href="css/style.css" 						type="text/css" rel="stylesheet">
		<link href="css/knctModal.css" 					type="text/css" rel="stylesheet">
		<link href="css/face.css" 						type="text/css" rel="stylesheet">

	  	<link href="http://code.jquery.com/ui/1.10.1/themes/base/jquery-ui.css" type="text/css" rel="stylesheet">
		<link href="css/jquery.jqplot.css" 										type="text/css" rel="stylesheet">

		<style>
      		.carousel-control
      		{
       			font-size: 350;
        		color: #C33;
      		}
        	.right
        	{
         		margin-right: 30px;
        	}
      		.carouselA
      		{
        		font-size: 80;
        		color: #C33;
        		text-align: center;
      		}
      		.carouselA:hover
      		{
        		text-decoration: none;
      		}
      		.active.item
      		{
        		background:rgba(255,255,255,0.8);
      		}
      		#chartdiv
      		{
	  			margin:50px auto 50px auto;
	  		}
	  		#snapshotsTitle
	  		{
	  			text-align: center;
	  		}
    	</style>
	</head>

	<body>
		<div id="impress">

			<div id="start" class="step slide">
				<div class="navbar navbar-fixed-top">
					<img src="img/Panaroma.png"> </img>
				</div>

				<div class="row-fluid">
					<div class="span6 offset3 portfolio-item">
						<div class="image-wrapper kinectOut" id="kinectTarget">
							<img class="portfolio-item" src="img/logo.png" alt="Speechero"></img>
						</div>
					</div>
				</div>
				<div style="position: absolute; bottom: 50; right: 40px; background-color: #D5462C; padding: 20px; color: white;">
					<h1> Swipe Right Hand Across Body</h1>
				</div>
			</div>
			<div id="instr" class="step slide" data-x="2000" data-y="0">
				<div class="navbar navbar-fixed-top">
					<img src="img/Panaroma.png"> </img>
				</div>

				<div class="row-fluid" style="margin-top: 40px;">
					<div class="span6 offset3 portfolio-item">
						<div class="span2 offset1"></div>
						<div class="span6" style="margin-bottom: 100px;">
							<div class="caption container" >
								<p class="large pink" id="chooseTopic" style="opacity: 1; ">
									How it works
								</p>
							</div>
						</div>
						<div id="ytapiplayer">
						</div>
					</div>
				</div>
				<div style="position: absolute; bottom: 50; right: 40px; background-color: #D5462C; padding: 20px;">
					<h1 style="color: white"> Swipe when you're ready!</h1>
				</div>
			</div>

			<div id="instr2" class="step slide" data-x="8000" data-y="-1000" data-z="400">
				<div class="navbar navbar-fixed-top">
					<img src="img/Panaroma.png"> </img>
				</div>

				<!--<div class="row-fluid" style="width: 50%; margin: auto; margin-top: 40px;">
					<div class="span6 offset3 portfolio-item">
						<div class="span2 offset1"></div>
						<div class="span6" style="margin-bottom: 100px;">-->
							<div class="caption container" style="width:50%; margin:auto; margin-top: 100px;">
								<p class="large pink" id="chooseTopic" style="opacity: 1; ">
									What do you do? 
								</p>
								<p class="medium pink" style="opacity: 1; margin-top: 40px ">
	    							Just talk. We'll give you prompts, watch your gesturing
	    							and give you feedback<br/> at the end. It's that easy.
	    						</p>
							</div>
							<div style="position: absolute; bottom: 50; right: 40px; background-color: #D5462C; padding: 20px;">
								<h1 style="color: white"> Swipe when you're ready!</h1>
							</div>
						<!--</div>
					</div>
				</div>-->
			</div>

			<div id="topicSelect" class="step slide" data-x="4000" data-y="0" style="text-align: center;">
				<div class="navbar navbar-fixed-top">
      				<img src="img/Panaroma.png"></img>
    			</div>
    
      			<div class="prompts" style="margin-top:70px;">
        			<div class="row" style="padding-left:30px;">
          				<div class="caption container" >
            				<div class=" offset1"></div>
            				<div class="span12">
            					<p class="large pink" id="chooseTopic" style="opacity: 1;">Here are some prompts to get you thinking, swipe when you're ready to start!</p>
            				</div>
            				<div class="span5">
							<p id = "choice0" class="choice medium white text-pink add-space" style="opacity: 1;"> Greek Life (sucks?) </p>
							<p id = "choice1" class="choice medium white text-pink add-space" style="opacity: 1;"> Drug Legalization </p>
							<p id = "choice2" class="choice medium white text-pink add-space" style="opacity: 1;"> Harry Potter vs Lord of the Rings vs Star Wars </p>
						</div>
						<div class="span5">
							<p id = "choice3" class="choice medium white text-pink add-space" style="opacity: 1;"> Cats vs Dogs </p>
							<p id = "choice4" class="choice small white text-pink add-space" style="opacity: 1;">Why your fav. TV show rocks.</p>
							<p id = "choice5" class="choice medium white text-pink add-space" style="opacity: 1;"> Vamps vs Werewolves </p>
							<p id = "choice6" class="choice medium white text-pink add-space" style="opacity: 1;"> Or Make Up Your Own </p>
							</div>
						</div>
        			</div>
      			</div>
      			<!--
      			<div id="myCarousel" class="carousel" style="margin-top: 280px">
        			<ol class="carousel-indicators" style="visibility:hidden">
          				<li data-target="#myCarousel" data-slide-to="0" class="active"></li>
          				<li data-target="#myCarousel" data-slide-to="1"></li>
          				<li data-target="#myCarousel" data-slide-to="2"></li>
        			</ol>
        			
        			<div class="carousel-inner">
          				<div class="active item">
            				<a class="carouselA" href="testing/rockingModulePractice.html?parameter=Greek_Life">
            					<p id = "choice0" >Greek Life (sucks?)</p>
            				</a>
          				</div>
          				<div class="item">
          					<a class="carouselA" href="testing/rockingModulePractice.html?parameter=Drug_Legalization">
          						<p id = "choice1" class="choice medium white text-pink add-space" style="opacity: 1;"> Drug Legalization
          						</p>
          					</a>
          				</div>
          				<div class="item">
          					<a class="carouselA" href="testing/rockingModulePractice.html?parameter=Harry_Potter">
          						<p id = "choice2" class="choice medium white text-pink add-space" style="opacity: 1;"> Harry Potter vs Lord of the Rings
          						</p>
          					</a>
          				</div>
          				<div class="item">
          					<a class="carouselA" href="testing/rockingModulePractice.html">
          						<p id = "choice3" class="choice medium white text-pink add-space" style="opacity: 1;"> Cats vs Dogs
          						</p>
          					</a>
          				</div>
         				<div class="item">
         					<a class="carouselA" href="testing/rockingModulePractice.html">
         						<p id = "choice4" class="choice small white text-pink add-space" style="opacity: 1;">Why your fav. TV show rocks.</p>
         					</a>
         				</div>
          				<div class="item">
          					<a class="carouselA" href="testing/rockingModulePractice.html">
          						<p id = "choice5" class="choice medium white text-pink add-space" style="opacity: 1;"> Vamps vs Werewolves
          						</p>
          					</a>
          				</div>
          				<div class="item">
          					<a class="carouselA" href="testing/rockingModulePractice.html">
          						<p id = "choice6" class="choice medium white text-pink add-space" style="opacity: 1;"> Or Make Up Your Own 
          						</p>
          					</a>
          				</div>
        			</div>
     
        			<a class="carousel-control left carouselA" href="#myCarousel" data-slide="prev">&lsaquo;</a>
        			<a class="carousel-control right carouselA" href="#myCarousel" data-slide="next">&rsaquo;</a>
        		-->
    		</div>

	    	<div id="practiceRound" class="step slide" data-x="6000" data-y="0">
				<div class="navbar navbar-fixed-top">
					<img src="img/Panaroma.png"> </img>
				</div>
				<div id="heroHeader" style="fixed:top;">
				</div>

				<div class="modal" id="myModal" style="top:400px;"><!-- note the use of "hide" class -->
				    <div class="caption container" style="padding-top:90px;">
				    	<p class="medium pink" style="opacity: 1;">PRACTICE ROUND: 
			            </p>
			            <p class="medium pink" style="opacity: 1;">Rock from side to side 
			            </p>
			            <p class="medium pink " style="opacity: 1;"> and see the red X move.</p>
			    	</div>
				</div>â€‹		

				<!-- Progress Bar that displays different areas of the code -->
				<div class="progressContainer" style="width: 50%; margin-top: 80px;">
					<table border="0" width="100%">
						<col width="25%">
						<col width="25%">
						<col width="25%">
						<col width="25%">
						<tr>
							<td><h1></h1></td>
							<td><h3></h3></td>
							<td><h3></h3></td>
							<td><h3></h3></td>
						</tr>
					</table>
					<div class="progress progress-striped active" style="width:100%;">
						<div class="bar" style="width: 0%;"></div>
					</div>
				</div>
				<!-- End of Progress Bar code -->

				<div id="topHero">
					<div class="waveContainer" id="practiceWaveContainer"></div>
					<div class="fancyClock" id="practiceFancyClock"></div>
				</div>
	    	</div>

	    	<div id="reminder" class="step slide" data-x="8000" data-y="2000">
				<div class="navbar navbar-fixed-top">
						<img src="../img/Panaroma.png"> </img>
				</div>
	    		<div style="width: 50%; margin: auto; margin-top:100px;">
	    			<div class="caption container" style="padding-top:40px;">
	    			<h1 style="font-size:60px; line-height:50px;"> Remember those topics we<br/> showed you?</h1>
	    			<p  class="medium pink" style="opacity: 1; margin-top: 40px ">
	    				Now it's time to talk about one of them<br/> (or something else) for 2 minutes. <br/>In this module, we'll be tracking your body<br/> so be careful not to rock!
	    			</p></div>
	    		</div>
	    		<div style="position: absolute; bottom: 50; left: 40px; background-color: #D5462C; padding: 20px;">
					<h1 style="color: white"> Swipe when you're ready!</h1>
				</div>
	    	</div>

			<div id="speakingRound" class="step slide" data-x="8000" data-y="0">
				<div class="navbar navbar-fixed-top">
						<img src="../img/Panaroma.png"> </img>
				</div>

				<!-- MODAL CODE- The popup that gives instructions for the exercise -->
				<div class="modal" id="myModal2" style="top:400px;"><!-- note the use of "hide" class -->
					<div class="caption container" style="padding-top:40px;">
						<p class="medium pink" style="opacity: 1;"> Now, start your real speech! </p>
					</div>
				</div>â€‹
				<div id="heroHeader2" style="fixed:top;"></div>
				<div class="progressContainer" style="width: 50%; margin-top: 80px;">
					<h2 style="text-align:center; margin-bottom:0px; padding-bottom:0px; font-family: 'Lato', sans-serif; color:#215879;"> Suggested pace 
					</h2> 
					<table border="0" width="100%">
						<col width="25%">
						<col width="25%">
						<col width="25%">
						<col width="25%">
						<tr>
							<td id="intro"><h1>Introduction</h1></td>
							<td id="arg1"><h3>Argument 1</h3></td>
							<td id="arg2"><h3>Argument 2</h3></td>
							<td id="conclusion"><h3>Conclusion</h3></td>
						</tr>
					</table>
					<div class="progress progress-striped active" style="width:100%;">
						<div class="bar" style="width: 0%;"></div>
					</div>
				</div>
				<div id="topHero">
					<div class="waveContainer" id="actualWaveContainer"></div>
					<div class="fancyClock" id="actualFancyClock"></div>
				</div>				
			</div>

			<div id="score" class="step slide" data-x="10000" data-y="0">
				<div class="navbar navbar-fixed-top">
					<img src="img/Panaroma.png"> </img>
				</div>

				<div style="width: 50%; margin-left: auto; margin-right: auto; margin-top: 80px;">
					<p>
						<h1 style="text: align-center">
							<a id="feedback_element">Congrats!</a> Your score: <a id="score_element"> 0</a>/100 
						<h1>
					</p>
				</div>

				<div id="face_and_bar_wrapper">
					<div id="bar_div">
						<img class="progress_bar" id="progress_bar_green" src="img/Progress_Bar_Green.png"> </img>
						<img class="progress_bar" id="progress_bar_black" src="img/Progress_Bar_Black.png"> </img>
					</div>
					<img class="face" id="yellow_face" src="img/Yellow_Face.png"></img>
					<img class="face" id="green_face" src="img/Green_Face.png"></img>
					<img class="face" id="red_face" src="img/Red_Face.png"></img>
					<img class="face" src="img/Face.png"></img>
					<img class="mouth" id="mouth" src="img/Mouth.png"></img>
					<img class="mouth" id="mouth_sad" src="img/Mouth_Sad.png"></img>
				</div>
			</div>
			<div id="report" class="step slide" data-x="12000" data-y="0">
				<div class="navbar navbar-fixed-top">
					<img src="img/Panaroma.png"> </img>
				</div>

				<div id="topChartInfo" style="float: left; margin:auto; margin-top: 40px; overflow: hidden; padding-left: 80px;">
					<div id="heatMapContainer" style='float: left;background-color:#D5462C'>
						<div id="innerstyle" style="padding: 20px; float: left;">
							<h2 style='text-align: center; color: #FEEAD0; margin-bottom: 0px; padding-bottom: 0px'> Your Hips </h2>
							<img src="img/stickbro.png" style='position:absolute; height: 375px;'></img>
							<div id="heatMapDiv" style="float:left; margin: 10px; border: 4px solid #850004"></div>
						</div>
					</div>
					<div id="chartdiv" style="height:300px;width:700px; float:left; margin-top: 120px; margin-left: 40px;"></div>
				</div>

				<div id="snapshotsContainer" style="float: left;"></div>
				<div id="pics" style="float: left"></div>
			</div>
		</div>

		<script src="http://code.jquery.com/jquery-1.9.1.min.js"></script>
		<script src="js/jqplot/jquery.jqplot.min.js" type="text/javascript" language="javascript"></script>

		<script src="js/impress.js"></script>
		<script src="js/jquery.js"></script>
	    <script src="js/bootstrap.js"></script>
	    <script src="js/plugins.js"></script>
	    <script src="js/setup.js"></script>
	    <script src="js/kinect.js"></script>
		<script src="js/heroKinectEngine.js"></script>
		<script src="js/monitorHero.js"></script>
		<script src="js/waves.js"></script>
		<script src="js/clockHero.js"></script>
		<script src="js/progressHero.js"></script>
		<script src="js/face.js"></script>
		<script src="js/swfobject.js"></script>

		<script>
			//	Callback for youtube api to get ytplayer

			function onYouTubePlayerReady(playerId) {
     			ytplayer = document.getElementById("playerid");	// bad global but I don't care :p
    		}

			var runSpeakingPagesScript = function( waveMaker, clockHero, monitor )
			{
				var _clockHero = clockHero;
				var _waveMaker = waveMaker;
				monitorHero.initHandTracker = false;

				if ( monitor === false )
				{
					if(!$("#myModal").is(":visible"))
					{
						$("#myModal").toggle();
					}
					
					_clockHero.stopClock();
					progressHero._reset();

					window.setTimeout(function()
					{
						$("#myModal").toggle();
						_clockHero.startClock(.5, 0);

						heroKinectEngine.registerCallback(_waveMaker.kinectCallback, _waveMaker);
						progressHero.animate(30);

					}, 2000);
				}
				else if ( monitor === true )
				{
					//	We know that A) we're on the actual practice page
					//	so the modal dialog is #myModal2 and B) that we
					//	need to start tracking user activity

					if(!$("#myModal2").is(":visible"))
					{
						$("#myModal2").toggle();
					}

					_clockHero.stopClock();
					monitorHero.initHeatMap();		//	We can initialize our heatmap now
					progressHero._reset();

					window.setTimeout(function()
					{
						$("#myModal2").toggle();
						_clockHero.startClock(2, 0);	// takes a little while to start so lets init early

						heroKinectEngine.registerCallback(_waveMaker.kinectCallback, _waveMaker);
						heroKinectEngine.registerCallback(monitorHero.kinectCallback, monitorHero);

						progressHero.animate(120);

					}, 2000);					
				}
			}

			var cleanSpeakingPage = function( waveMaker, clockHero, monitoring )
			{
				if (!monitoring)
				{
					heroKinectEngine.unbindCallback( waveMaker );
				}
				else if (monitoring)
				{
					//	Let's clean up all the messy callbacks so we aren't 
					//	wasting processing power
					heroKinectEngine.unbindCallback( waveMaker );
					heroKinectEngine.unbindCallback( monitorHero );	// unbinds everything to this object
				}
				progressHero._reset();
			}
			
			var startInstructionalVideo = function()
			{
				monitorHero.initHandTracker = true;
				if (ytplayer)
				{
					ytplayer.playVideo();
				}
			}

			var cleanInstrPage = function()
			{

			}

			var runScorePage = function(_face)
			{
				monitorHero.initHandTracker = true;
				_face.animateScore(82);
			}

			var runReportPage = function()
			{
				monitorHero.initHandTracker = true;
				monitorHero.drawHeatMap(localStorage.heatMap, "#heatMapDiv");
				monitorHero.plotTrackable(localStorage.trackable, 'chartdiv');
			}

			$(function()
			{
				//	Initialize everything that can be initialized right on page load 	//

				impress().init();	// Revvv up dat beauty machine 
				$('.carousel').carousel();

				var practiceWaveMaker = new wave();			//	Initialize our wave pool
				practiceWaveMaker.init('practiceWaveContainer', 'practiceWaveCanvas');	// I think this is looping, so we might want to be careful here.

				var actualWaveMaker = new wave();	// Initialize wave pool for actual page.
				actualWaveMaker.init('actualWaveContainer', 'actualWaveCanvas');	//	again this is looping, so we might want to rewrite the init function to only loop when animation loop should be started. Wasting processing power.

				var practiceClockHero = new clock('practiceFancyClock'); //	initialize a clock for practice
					practiceClockHero.registerCallback(function(){ document.impressNext() });
				var actualClockHero = new clock('actualFancyClock');	 // initialize a clock for real
					actualClockHero.registerCallback(function(){ document.impressNext() });

				var reportFace = new _face();

				heroKinectEngine.initKinect()	//	Rev up the gesture engine!!!!!ALL SYSTEMS GO!!

				monitorHero.initHandTracker = true;
				heroKinectEngine.registerCallback(monitorHero.trackHands, monitorHero);
				// Deal with this youtube video init business here 
				var params = { allowScriptAccess: "always" };
    			var atts = { id: "playerid" };
    			swfobject.embedSWF("http://www.youtube.com/v/LXxXSg78Rl0?enablejsapi=1&version=3",
    				"ytapiplayer", "1000", "600", "8", null, null, params, atts);

    			var page_state = "#/start";	// current page state, useful for binding and unbinding objects

				// Router hero --- Listens to all hash changes and calls required javascript //
				$(window).on('hashchange', function()
				{
					// First do some housekeeping on various listeners 
					if (page_state === "#/practiceRound")
					{
						cleanSpeakingPage( practiceWaveMaker, practiceClockHero, false );
						heroKinectEngine.registerCallback(monitorHero.trackHands, monitorHero);

					}
					else if (page_state === "#/speakingRound")
					{
						cleanSpeakingPage( actualWaveMaker, actualClockHero, true );
						heroKinectEngine.registerCallback(monitorHero.trackHands, monitorHero);

					}
					else if ( page_state === "#/instr" )
					{
						cleanInstrPage();
					}

					//	Now we can navigate to our new page with clean 
					//	listeners and a clear conscience :)
					var _location = location.hash;
					page_state = _location;	// update our state

					if (_location === '#/practiceRound')
					{	
						heroKinectEngine.unbindCallback( monitorHero );	// unbinds everything to this object
						runSpeakingPagesScript( practiceWaveMaker, practiceClockHero, false );
					}
					else if (_location === '#/speakingRound')
					{
						heroKinectEngine.unbindCallback( monitorHero );	// unbinds everything to this object
						// pass in true so that we know to start monitoring activity with heromonitor.
						runSpeakingPagesScript( actualWaveMaker, actualClockHero, true);
					}
					else if (_location === '#/instr')
					{
						startInstructionalVideo();
					}
					else if (_location === '#/score')
					{
						runScorePage(reportFace);
					}
					else if (_location === '#/report')
					{
						runReportPage();
					}
				});
			});
		</script>
	</body>	
</html>
